<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ziyaretçi Logları</title>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <h1>Ziyaretçi Logları</h1>
    <table>
        <thead>
            <tr>
                <th>IP</th>
                <th>Tarayıcı</th>
                <th>Platform</th>
                <th>Ekran Boyutu</th>
                <th>Dil</th>
                <th>Konum</th>
            </tr>
        </thead>
        <tbody id="logTable"></tbody>
    </table>

    <script>
        // Sunucudan kayıtlı logları çeken fonksiyon
        async function fetchLogs() {
            try {
                const res = await fetch('/api/getLogs'); 
                const logs = await res.json();
                const table = document.getElementById('logTable');
                table.innerHTML = '';

                logs.forEach(log => {
                    // Şehir/ülke bilgisi
                    const locationText = (log.location && log.location !== "Bilinmeyen, Bilinmeyen")
                        ? log.location
                        : "Konum alınamadı";

                    // Enlem, boylam varsa metin ve opsiyonel Google Maps linki
                    let coordsText = '';
                    if (log.latitude && log.longitude) {
                        coordsText = `(${log.latitude}, ${log.longitude})`;
                    }

                    // İsterseniz harici harita linki de ekleyebilirsiniz:
                    // Örneğin: <a href="https://maps.google.com/?q=lat,lon" target="_blank">Haritada Aç</a>
                    let mapLink = '';
                    if (log.latitude && log.longitude) {
                        mapLink = `<a href="https://maps.google.com/?q=${log.latitude},${log.longitude}" target="_blank">Haritada Aç</a>`;
                    }

                    // Konum hücresinde hepsini bir arada gösterelim:
                    // "Şehir, Ülke" altına "(lat, lon)" ve link
                    const finalLocationCell = `
                        ${locationText}
                        ${coordsText ? `<br>${coordsText}` : ''}
                        ${mapLink ? `<br>${mapLink}` : ''}
                    `;

                    const row = `
                        <tr>
                            <td>${log.ip}</td>
                            <td>${log.userAgent}</td>
                            <td>${log.platform}</td>
                            <td>${log.screenWidth}x${log.screenHeight}</td>
                            <td>${log.language}</td>
                            <td>${finalLocationCell}</td>
                        </tr>
                    `;
                    table.innerHTML += row;
                });
            } catch (error) {
                console.error("Veri çekme hatası:", error);
            }
        }

        // Sayfa açıldığında ve 5 saniyede bir logları yenile
        fetchLogs(); 
        setInterval(fetchLogs, 5000);
    </script>
</body>
</html>
